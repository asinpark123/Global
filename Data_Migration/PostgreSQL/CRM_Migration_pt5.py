import psycopg

# Connect to an existing database
# globalcore_local public schema connection
with psycopg.connect("dbname=globalcore_local user=postgres password='an!mat10N' host='localhost' port= '5432'") as conn:

    new_glEntity_gfResource = [(84, 153), (188, 25), (196, 316), (198, 228), (207, 301), (223, 324), (236, 300), (240, 18), (241, 487), (249, 415), (250, 328), (258, 225), (284, 686), (290, 121), (295, 51), (303, 171), (309, 143), (311, 708), (313, 96), (314, 54), (315, 382), (319, 42), (321, 11), (322, 115), (324, 134), (325, 15), (333, 32), (344, 469), (351, 439), (354, 29), (355, 305), (360, 66), (362, 452), (364, 85), (365, 136), (369, 663), (383, 27), (387, 108), (389, 16), (390, 33), (391, 127), (395, 253), (396, 173), (398, 106), (402, 414), (421, 257), (429, 299), (431, 52), (447, 44), (449, 730), (450, 248), (456, 242), (461, 14), (463, 160), (465, 78), (467, 138), (468, 35), (471, 204), (477, 167), (482, 128), (483, 175), (484, 43), (487, 224), (490, 536), (492, 775), (493, 37), (497, 223), (501, 168), (502, 431), (503, 101), (510, 327), (526, 372), (527, 99), (539, 681), (543, 467), (560, 6), (562, 193), (563, 65), (565, 459), (566, 187), (576, 3), (581, 435), (582, 188), (584, 104), (586, 40), (587, 148), (592, 117), (594, 61), (600, 218), (618, 105), (648, 800), (650, 112), (670, 123), (684, 288), (929, 90), (933, 323), (934, 434), (939, 340), (960, 437), (966, 384), (977, 358), (981, 464), (989, 321), (1006, 468), (1020, 161), (1046, 454), (1052, 377), (1064, 429), (1120, 297), (1130, 318), (1170, 291), (1193, 484), (1224, 660), (1228, 442), (1305, 286), (1405, 126), (1424, 67), (1456, 535), (1477, 12), (1489, 333), (1527, 170), (1536, 398), (1564, 141), (1567, 19), (1582, 282), (1584, 145), (1638, 427), (1649, 335), (1685, 550), (1701, 195), (1733, 30), (1776, 292), (1912, 190), (1948, 470), (1970, 1), (1971, 2), (1972, 4), (1973, 5), (1974, 7), (1975, 8), (1976, 9), (1977, 10), (1978, 13), (1979, 17), (1980, 20), (1981, 21), (1982, 22), (1983, 23), (1984, 24), (1985, 26), (1986, 28), (1987, 31), (1988, 34), (1989, 36), (1990, 38), (1991, 39), (1992, 41), (1993, 45), (1994, 46), (1995, 47), (1996, 48), (1997, 49), (1998, 50), (1999, 53), (2000, 55), (2001, 56), (2002, 57), (2003, 58), (2004, 59), (2005, 60), (2006, 62), (2007, 63), (2008, 64), (2009, 68), (2010, 69), (2011, 70), (2012, 71), (2013, 72), (2014, 73), (2015, 74), (2016, 75), (2017, 76), (2018, 77), (2019, 79), (2020, 80), (2021, 81), (2022, 82), (2023, 83), (2024, 84), (2025, 86), (2026, 87), (2027, 88), (2028, 89), (2029, 91), (2030, 92), (2031, 93), (2032, 94), (2033, 95), (2034, 97), (2035, 98), (2036, 100), (2037, 102), (2038, 103), (2039, 107), (2040, 109), (2041, 110), (2042, 111), (2043, 113), (2044, 114), (2045, 116), (2046, 118), (2047, 119), (2048, 120), (2049, 122), (2050, 124), (2051, 125), (2052, 129), (2053, 130), (2054, 131), (2055, 132), (2056, 133), (2057, 135), (2058, 137), (2059, 139), (2060, 140), (2061, 142), (2062, 144), (2063, 146), (2064, 147), (2065, 154), (2066, 155), (2067, 156), (2068, 157), (2069, 158), (2070, 159), (2071, 162), (2072, 163), (2073, 164), (2074, 165), (2075, 166), (2076, 169), (2077, 172), (2078, 174), (2079, 176), (2080, 177), (2081, 178), (2082, 179), (2083, 181), (2084, 182), (2085, 183), (2086, 184), (2087, 185), (2088, 186), (2089, 189), (2090, 191), (2091, 192), (2092, 194), (2093, 196), (2094, 197), (2095, 198), (2096, 199), (2097, 200), (2098, 201), (2099, 202), (2100, 203), (2101, 205), (2102, 206), (2103, 207), (2104, 208), (2105, 209), (2106, 210), (2107, 211), (2108, 212), (2109, 213), (2110, 214), (2111, 215), (2112, 216), (2113, 217), (2114, 219), (2115, 220), (2116, 221), (2117, 222), (2118, 226), (2119, 227), (2120, 229), (2121, 230), (2122, 231), (2123, 232), (2124, 233), (2125, 234), (2126, 235), (2127, 236), (2128, 237), (2129, 238), (2130, 239), (2131, 240), (2132, 241), (2133, 243), (2134, 244), (2135, 245), (2136, 246), (2137, 247), (2138, 249), (2139, 250), (2140, 251), (2141, 252), (2142, 254), (2143, 255), (2144, 256), (2145, 258), (2146, 259), (2147, 260), (2148, 261), (2149, 262), (2150, 263), (2151, 264), (2152, 265), (2153, 266), (2154, 280), (2155, 281), (2156, 283), (2157, 284), (2158, 285), (2159, 287), (2160, 290), (2161, 293), (2162, 294), (2163, 295), (2164, 296), (2165, 298), (2166, 302), (2167, 303), (2168, 304), (2169, 306), (2170, 307), (2171, 308), (2172, 309), (2173, 310), (2174, 311), (2175, 312), (2176, 313), (2177, 314), (2178, 315), (2179, 317), (2180, 319), (2181, 320), (2182, 322), (2183, 325), (2184, 326), (2185, 329), (2186, 330), (2187, 331), (2188, 332), (2189, 334), (2190, 336), (2191, 337), (2192, 338), (2193, 339), (2194, 341), (2195, 342), (2196, 343), (2197, 344), (2198, 345), (2199, 346), (2200, 347), (2201, 348), (2202, 349), (2203, 350), (2204, 351), (2205, 352), (2206, 353), (2207, 354), (2208, 355), (2209, 356), (2210, 357), (2211, 359), (2212, 360), (2213, 361), (2214, 362), (2215, 363), (2216, 364), (2217, 365), (2218, 366), (2219, 367), (2220, 368), (2221, 369), (2222, 370), (2223, 371), (2224, 373), (2225, 374), (2226, 375), (2227, 376), (2228, 378), (2229, 379), (2230, 380), (2231, 381), (2232, 383), (2233, 385), (2234, 386), (2235, 387), (2236, 388), (2237, 389), (2238, 390), (2239, 391), (2240, 392), (2241, 393), (2242, 394), (2243, 395), (2244, 396), (2245, 397), (2246, 399), (2247, 400), (2248, 401), (2249, 402), (2250, 404), (2251, 405), (2252, 406), (2253, 407), (2254, 408), (2255, 409), (2256, 410), (2257, 411), (2258, 417), (2259, 418), (2260, 419), (2261, 420), (2262, 421), (2263, 422), (2264, 428), (2265, 430), (2266, 433), (2267, 436), (2268, 438), (2269, 441), (2270, 444), (2271, 445), (2272, 446), (2273, 447), (2274, 448), (2275, 449), (2276, 450), (2277, 451), (2278, 453), (2279, 455), (2280, 456), (2281, 457), (2282, 458), (2283, 460), (2284, 461), (2285, 462), (2286, 463), (2287, 465), (2288, 466), (2289, 471), (2290, 472), (2291, 473), (2292, 474), (2293, 475), (2294, 476), (2295, 477), (2296, 478), (2297, 479), (2298, 480), (2299, 481), (2300, 482), (2301, 483), (2302, 486), (2303, 489), (2304, 490), (2305, 491), (2306, 492), (2307, 493), (2308, 494), (2309, 495), (2310, 496), (2311, 497), (2312, 498), (2313, 500), (2314, 501), (2315, 502), (2316, 503), (2317, 504), (2318, 505), (2319, 506), (2320, 507), (2321, 508), (2322, 511), (2323, 512), (2324, 513), (2325, 514), (2326, 517), (2327, 518), (2328, 519), (2329, 520), (2330, 521), (2331, 522), (2332, 523), (2333, 524), (2334, 525), (2335, 526), (2336, 527), (2337, 528), (2338, 529), (2339, 530), (2340, 531), (2341, 532), (2342, 533), (2343, 534), (2344, 540), (2345, 541), (2346, 542), (2347, 543), (2348, 544), (2349, 545), (2350, 546), (2351, 547), (2352, 548), (2353, 549), (2354, 551), (2355, 552), (2356, 553), (2357, 554), (2358, 555), (2359, 556), (2360, 557), (2361, 558), (2362, 559), (2363, 560), (2364, 561), (2365, 562), (2366, 563), (2367, 564), (2368, 565), (2369, 566), (2370, 572), (2371, 574), (2372, 575), (2373, 576), (2374, 577), (2375, 578), (2376, 579), (2377, 580), (2378, 581), (2379, 583), (2380, 588), (2381, 590), (2382, 591), (2383, 592), (2384, 593), (2385, 594), (2386, 595), (2387, 596), (2388, 597), (2389, 598), (2390, 599), (2391, 600), (2392, 601), (2393, 602), (2394, 603), (2395, 604), (2396, 605), (2397, 606), (2398, 608), (2399, 610), (2400, 611), (2401, 612), (2402, 613), (2403, 614), (2404, 615), (2405, 616), (2406, 617), (2407, 618), (2408, 619), (2409, 620), (2410, 622), (2411, 623), (2412, 624), (2413, 625), (2414, 626), (2415, 627), (2416, 628), (2417, 629), (2418, 630), (2419, 631), (2420, 632), (2421, 633), (2422, 634), (2423, 635), (2424, 636), (2425, 637), (2426, 638), (2427, 639), (2428, 640), (2429, 641), (2430, 642), (2431, 643), (2432, 645), (2433, 646), (2434, 647), (2435, 648), (2436, 649), (2437, 650), (2438, 651), (2439, 652), (2440, 653), (2441, 655), (2442, 656), (2443, 657), (2444, 659), (2445, 661), (2446, 662), (2447, 664), (2448, 665), (2449, 666), (2450, 667), (2451, 668), (2452, 669), (2453, 670), (2454, 671), (2455, 672), (2456, 673), (2457, 674), (2458, 675), (2459, 676), (2460, 677), (2461, 678), (2462, 679), (2463, 680), (2464, 682), (2465, 683), (2466, 684), (2467, 685), (2468, 687), (2469, 688), (2470, 689), (2471, 691), (2472, 692), (2473, 693), (2474, 694), (2475, 695), (2476, 696), (2477, 697), (2478, 698), (2479, 700), (2480, 701), (2481, 702), (2482, 703), (2483, 704), (2484, 705), (2485, 706), (2486, 709), (2487, 710), (2488, 711), (2489, 712), (2490, 713), (2491, 714), (2492, 715), (2493, 716), (2494, 717), (2495, 718), (2496, 719), (2497, 720), (2498, 721), (2499, 722), (2500, 723), (2501, 724), (2502, 725), (2503, 726), (2504, 727), (2505, 728), (2506, 729), (2507, 731), (2508, 732), (2509, 733), (2510, 734), (2511, 735), (2512, 737), (2513, 738), (2514, 739), (2515, 740), (2516, 741), (2517, 742), (2518, 743), (2519, 744), (2520, 745), (2521, 746), (2522, 747), (2523, 748), (2524, 750), (2525, 751), (2526, 753), (2527, 754), (2528, 755), (2529, 756), (2530, 757), (2531, 759), (2532, 760), (2533, 761), (2534, 762), (2535, 763), (2536, 764), (2537, 765), (2538, 766), (2539, 768), (2540, 769), (2541, 770), (2542, 771), (2543, 772), (2544, 773), (2545, 774), (2546, 776), (2547, 777), (2548, 778), (2549, 779), (2550, 780), (2551, 782), (2552, 783), (2553, 787), (2554, 788), (2555, 789), (2556, 790), (2557, 792), (2558, 793), (2559, 795), (2560, 798), (2561, 799), (2562, 149), (2563, 150), (2564, 151), (2565, 152), (2566, 180), (2567, 276), (2568, 277), (2569, 278), (2570, 279), (2571, 289), (2572, 403), (2573, 412), (2574, 413), (2575, 416), (2576, 423), (2577, 424), (2578, 425), (2579, 426), (2580, 432), (2581, 440), (2582, 443), (2583, 485), (2584, 488), (2585, 499), (2586, 509), (2587, 510), (2588, 515), (2589, 516), (2590, 537), (2591, 538), (2592, 539), (2593, 567), (2594, 568), (2595, 569), (2596, 570), (2597, 571), (2598, 573), (2599, 582), (2600, 584), (2601, 585), (2602, 586), (2603, 587), (2604, 589), (2605, 607), (2606, 609), (2607, 621), (2608, 644), (2609, 654), (2610, 658), (2611, 690), (2612, 699), (2613, 707), (2614, 736), (2615, 749), (2616, 752), (2617, 758), (2618, 767), (2619, 781), (2620, 784), (2621, 785), (2622, 786), (2623, 794), (2624, 796), (2625, 797)]


    contact_id_resource_id_list = []
    gfContact_resourceEntity_id = []
    contact_names = []
    new_glEntity_gfContacts = []
    # Open a cursor to perform database operations
    with conn.cursor() as cur:

    # swaps the value positions of tuples in new_glEntity_gfResource and turns it into dictionary and saves it into gfResource_glEntity
        gfResource_glEntity = dict([(pairs[1],pairs[0]) for pairs in new_glEntity_gfResource])
    # migrates GF contact into GL entity EXCEPT for all the 'Default Contact', populating GL entity parent_id with contact_id as a placeholder for now, which we'll use to populate the column correctly later
        cur.execute("SELECT id, CONCAT(first_name, ' ', last_name), resource_id FROM temp.resources_contact WHERE CONCAT(first_name, ' ', last_name) NOT LIKE '%Default Contact%' ORDER BY id ASC")
        result_pt5 = cur.fetchall()
        f = open("glEntity_gfContact.txt", "w")
        for results in result_pt5:
            contact_id_resource_id_list += [(results[0],results[2])]
            results_1 = results[1].replace("'","''")
            contact_names += [(results[1])]
            cur.execute("INSERT INTO public.crm_gl_entity (name, short_name, nzbn, pending, entity_type_id, parent_id) VALUES ('%s','', NULL,false, 5,%s) RETURNING id" % (results_1,results[0]))
            new_Entity_id = cur.fetchone()[0]
            new_glEntity_gfContacts += [(new_Entity_id,results[0])]
            f.write("entity: %s = contact: %s \n" % (new_Entity_id,results[0]))
        f.close()
        
    # creating a list of tuples of gfContact_id - gfResource's entity_id from two dict contact_id_resource_id and gfResource_glEntity
        contact_id_resource_id = dict(contact_id_resource_id_list)
        for contact_id, resource_id in contact_id_resource_id.items():
            if resource_id in gfResource_glEntity.keys():
                gfContact_resourceEntity_id += [(contact_id,gfResource_glEntity[resource_id])]
    # Updates the parent_id by replacing the placeholder(contact_id) with its actual parent's entity_id WHERE id > 2625 which should be where new data id post resource migration starts from
        for items in gfContact_resourceEntity_id:
            cur.execute("UPDATE public.crm_gl_entity SET parent_id = %s WHERE parent_id = %s AND id > 2625" % (items[1],items[0]))
        # print(contact_names)
        # print(contact_id_resource_id)
        print(gfContact_resourceEntity_id,'\n',new_glEntity_gfContacts)
        

        
        # Make the changes to the database persistent
        # conn.commit()
